#encoding=utf-8
import scrapy
from musiclyrics.items import MusiclyricsItem
import json
import time 
import re
from scrapy.contrib.spiders import CrawlSpider,Rule
from scrapy.contrib.linkextractors.sgml import SgmlLinkExtractor
class LycSpider(CrawlSpider):
	name = 'lyc'
	start_urls=['http://www.90lrc.cn/18248/%E7%8E%AB%E7%91%B0%E8%8A%B1%E7%9A%84%E7%9C%BC%E6%B3%AA']
	allowed_domains=['90lrc.cn']
 	rules=[Rule(SgmlLinkExtractor(allow=('/[0-9]{5,10}/.*$'),restrict_xpaths=('//li')),callback="parseLyrics",follow=True)]
	def parseLyrics(self,response):
		data = response.xpath("//div[@class='lyric']")
		item = MusiclyricsItem()
		url = response.url
		#title = data.xpath().extract()
		#author = data.xpath().extract()
		content = data.xpath("//li[@id='txt']/text()").extract()
		#if len(url)!=0 and len(title)!=0 and len(author)!=0 and len(content)!=0:
		if len(url)!=0 and len(content)!=0:
			item['url']=url
			#item['title']=title
			#item['author']=author
			item['content']=content[0]
			yield item

"""
	def parse(self, response):
		urls = response.xpath("//a/@href").extract()
		for url in urls:
			if len(re.findall(r"[0-9]+",url))!=0:
				url1 = self.base_url+url
				yield scrapy.Request(url1,self.parseLyrics)
"""
	
